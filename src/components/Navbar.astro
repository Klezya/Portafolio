---
import ThemeToggle from './ThemeToggle.astro';

const navLinks = [
  { href: '#sobre-mi', label: 'Sobre mí' },
  { href: '#proyectos', label: 'Proyectos' },
  { href: '#habilidades', label: 'Habilidades' },
  { href: '#certificados', label: 'Certificados' },
  { href: '#contacto', label: 'Contacto' },
];
---

<header class="sticky top-0 z-50 border-b navbar-glass" style="border-color: var(--color-border);">
  <nav class="container flex items-center justify-between py-4">
    <a href="/" class="text-lg font-bold tracking-tight font-display">
      <span style="color: var(--color-accent);">&lt;</span><span style="color: var(--color-text);">BN</span><span style="color: var(--color-accent);"> /&gt;</span>
    </a>

    <!-- Desktop nav -->
    <ul class="hidden md:flex items-center gap-6 text-sm font-medium" style="color: var(--color-text-muted);">
      {navLinks.map(({ href, label }) => (
        <li>
          <a href={href} class="hover:text-[var(--color-accent)] transition-colors">{label}</a>
        </li>
      ))}
    </ul>

    <div class="flex items-center gap-3">
      <ThemeToggle />

      <!-- Mobile hamburger -->
      <button
        id="mobile-menu-btn"
        class="md:hidden flex items-center justify-center w-10 h-10 rounded-lg transition-colors"
        style="color: var(--color-text);"
        aria-label="Abrir menú de navegación"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <svg id="menu-icon-open" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <line x1="4" y1="6" x2="20" y2="6"/><line x1="4" y1="12" x2="20" y2="12"/><line x1="4" y1="18" x2="20" y2="18"/>
        </svg>
        <svg id="menu-icon-close" class="hidden" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
  </nav>

  <!-- Mobile menu panel -->
  <div
    id="mobile-menu"
    class="md:hidden overflow-hidden transition-[max-height,opacity] duration-300 ease-in-out max-h-0 opacity-0"
    style="background-color: var(--color-bg-surface); border-top: 1px solid var(--color-border);"
  >
    <ul class="flex flex-col px-6 py-4 gap-1">
      {navLinks.map(({ href, label }) => (
        <li>
          <a
            href={href}
            class="mobile-nav-link block py-3 px-3 rounded-lg text-base font-medium transition-colors hover:bg-[var(--color-bg-muted)]"
            style="color: var(--color-text-muted);"
          >
            {label}
          </a>
        </li>
      ))}
    </ul>
  </div>
</header>

<script>
  const menuBtn = document.getElementById('mobile-menu-btn');
  const menu = document.getElementById('mobile-menu');
  const iconOpen = document.getElementById('menu-icon-open');
  const iconClose = document.getElementById('menu-icon-close');

  if (menuBtn && menu && iconOpen && iconClose) {
    let isOpen = false;

    function toggleMenu() {
      isOpen = !isOpen;
      menuBtn!.setAttribute('aria-expanded', String(isOpen));

      if (isOpen) {
        menu!.classList.remove('max-h-0', 'opacity-0');
        menu!.classList.add('max-h-96', 'opacity-100');
        iconOpen!.classList.add('hidden');
        iconClose!.classList.remove('hidden');
      } else {
        menu!.classList.add('max-h-0', 'opacity-0');
        menu!.classList.remove('max-h-96', 'opacity-100');
        iconOpen!.classList.remove('hidden');
        iconClose!.classList.add('hidden');
      }
    }

    menuBtn.addEventListener('click', toggleMenu);

    // Close on link click
    menu.querySelectorAll('a').forEach((link) => {
      link.addEventListener('click', () => {
        if (isOpen) toggleMenu();
      });
    });

    // Close on Escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && isOpen) toggleMenu();
    });
  }
</script>
